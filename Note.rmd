---
title: "Population vs. Vote"
author: "Runan Yao"
date: "October 5, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
```
# Read Data

## General Election Data

```{r}
X1992_results <- read_excel("Data/General Election 1992-2016/1992_results.xls")
X1994_results <- read_excel("Data/General Election 1992-2016/1994_results.xls")
X1996_results <- read_excel("Data/General Election 1992-2016/1996_results.xls")
X1998_results <- read_excel("Data/General Election 1992-2016/1998_results.xls")
X2000_results <- read_excel("Data/General Election 1992-2016/2000_results.xls", guess_max = 4076)
X2002_results <- read_excel("Data/General Election 1992-2016/2002_results.xls")
X2004_results <- read_excel("Data/General Election 1992-2016/2004_results.xls")
X2006_results <- read_excel("Data/General Election 1992-2016/2006_results.xls", guess_max = 4125)
X2008_results <- read_excel("Data/General Election 1992-2016/2008_results.xls", guess_max = 4133)
X2010_results <- read_excel("Data/General Election 1992-2016/2010_results.xls")
X2012_results <- read_excel("Data/General Election 1992-2016/2012_results.xlsx",guess_max = 4103)
X2014_results <- read_excel("Data/General Election 1992-2016/2014_results.xlsx",guess_max = 4106)
X2016_results <- read_excel("Data/General Election 1992-2016/2016_results.xlsx",guess_max = 4121)
```

```{r}
CountID.Name <- X2016_results %>% 
  select(COUNTYCODE, COUNTYNAME)
CountID.Name <- unique(CountID.Name)
```


## 2016 house dist vs. PCTNAME
```{r}
getCPCTCode <- function(CountyCode, PCTCode){
  CountyCode <- as.numeric(CountyCode) * 10000
  PCTCode <- as.numeric(PCTCode) %% 10000
  
  return(CountyCode+PCTCode)
}

pctDist <- X2016_results %>%
  select(one_of(c( "PCTNAME", "COUNTYCODE", "PCTCODE", "CONGDIST"))) %>%
  mutate(CPCTCode=getCPCTCode(COUNTYCODE, PCTCODE))

colnames(pctDist) <- c("pctDist_PCTNAME","pctDist_COUNTYCODE","pctDist_PCTCODE","pctDist_CONGDIST","CPCTCode")
```


# Merge Precinct data into House Distinct

## 1992
```{r}
colnames(X1992_results)[which(colnames(X1992_results) == '7am')] = 'reg'
colnames(X1992_results)[which(colnames(X1992_results) == 'FIPS_VTD')] = 'CPCTCode'
X1992_results$CPCTCode <- as.numeric(X1992_results$CPCTCode)
county.1992 <- X1992_results %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%
  summarise(reg = sum(reg), 
            turnout = sum(Ballots),
            PresIR = sum(PresIR),
            PresDFL = sum(PresDFL),
            PresOther = sum(PresOther),
            CongIR = sum(CongIR),
            CongDFL = sum(CongDFL),
            CongOther = sum(CongOther)
            )
colnames(county.1992)[1] <- 'HouseDistID'

summary(county.1992)

```

## 1994


```{r}
colnames(X1994_results)[which(colnames(X1994_results) == '7am')] = 'reg'
colnames(X1994_results)[which(colnames(X1994_results) == 'FIPS_VTD')] = 'CPCTCode'
X1994_results$CPCTCode <- as.numeric(X1994_results$CPCTCode)

county.1994 <- X1994_results %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%
  summarise(reg = sum(reg),
            turnout = sum(Ballots),
            USSenIR = sum(USSenIR),
            USSenDFL = sum(USSenDFL),
            USSenOther = sum(USSenOther),
            CongIR = sum(CongIR),
            CongDFL = sum(CongDFL),
            CongOther = sum(CongOther),            
            GovIR = sum(GovIR),
            GovDFL = sum(GovDFL),
            GovOther = sum(GovOther)   
            )
colnames(county.1994)[1] <- 'HouseDistID'

summary(county.1994)

```


## 1996

```{r}
colnames(X1996_results)[which(colnames(X1996_results) == '7am')] = 'reg'
colnames(X1996_results)[which(colnames(X1996_results) == 'FIPS_VTD')] = 'CPCTCode'
X1996_results$CPCTCode <- as.numeric(X1996_results$CPCTCode)
county.1996 <- X1996_results %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%
  summarise(reg = sum(reg),
            turnout = sum(Ballots),
            PresIR = sum(PresIR),
            PresDFL = sum(PresDFL),
            PresOther = sum(PresOther),
            USSenIR = sum(USSenIR),
            USSenDFL = sum(USSenDFL),
            USSenOther = sum(USSenOther),
            CongIR = sum(CongIR),
            CongDFL = sum(CongDFL),
            CongOther = sum(CongOther) 
            )
colnames(county.1996)[1] <- 'HouseDistID'

summary(county.1996)
```


## 1998

```{r}
colnames(X1998_results)[which(colnames(X1998_results) == '7am')] = 'reg'
colnames(X1998_results)[which(colnames(X1998_results) == 'FIPS_VTD')] = 'CPCTCode'
X1998_results$CPCTCode <- as.numeric(X1998_results$CPCTCode)

county.1998 <- X1998_results %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%
  summarise(reg = sum(reg),
            turnout = sum(Ballots),
            CongIR = sum(CongIR),
            CongDFL = sum(CongDFL),
            CongOther = sum(CongOther),            
            GovIR = sum(GovIR),
            GovDFL = sum(GovDFL),
            GovOther = sum(GovOther)   
            )
colnames(county.1998)[1] <- 'HouseDistID'

summary(county.1998)
```

## 2000
```{r}
colnames(X2000_results)[which(colnames(X2000_results) == '7am')] = 'reg'


county.2000 <- X2000_results %>%
  mutate(CPCTCode=getCPCTCode(CC, PRCT)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(Sign),
            PresIR = sum(R_PREZ),
            PresDFL = sum(DFL_PREZ),
            PresOther = sum(ALL_OTHER_PREZ),
            CongIR = sum(R_CONG),
            CongDFL = sum(DFL_CONG),
            CongOther = sum(OTHER_CONG),
            USSenIR = sum(R_USSEN),
            USSenDFL = sum(DFL_USSEN),
            USSenOther = sum(OTHER_USSEN)
            )
colnames(county.2000)[1] <- 'HouseDistID'

summary(county.2000)
```


## 2002
```{r}
colnames(X2002_results)[which(colnames(X2002_results) == '7am')] = 'reg'

county.2002 <- X2002_results %>%
  mutate(CPCTCode=getCPCTCode(CC, PRCT)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg, na.rm = TRUE),
            turnout = sum(Ballots),
            CongIR = sum(as.numeric(CongR), na.rm = TRUE),
            CongDFL = sum(as.numeric(CongDFL), na.rm = TRUE),
            CongAll = 
              sum(as.numeric(CongGP), na.rm = TRUE) + 
              sum(as.numeric(CongIP), na.rm = TRUE) + 
              sum(as.numeric(CongNNT), na.rm = TRUE) + 
              sum(as.numeric(CongWI), na.rm = TRUE),
            GovIR = sum(as.numeric(GovR), na.rm = TRUE),
            GovDFL = sum(as.numeric(GovDFL), na.rm = TRUE),
            GovAll = 
              sum(as.numeric(GovGP), na.rm = TRUE) +
              sum(as.numeric(GovIP), na.rm = TRUE) +
              sum(as.numeric(GovCP), na.rm = TRUE) +
              sum(as.numeric(GovI), na.rm = TRUE) +
              sum(as.numeric(GovSW), na.rm = TRUE) +
              sum(as.numeric(GovWI), na.rm = TRUE),
            USSenIR = sum(as.numeric(USSenR), na.rm = TRUE),
            USSenDFL = sum(as.numeric(USSenDFL), na.rm = TRUE),
            USSenOther = 
              sum(as.numeric(USSenGP), na.rm = TRUE) +
              sum(as.numeric(USSenIP), na.rm = TRUE) + 
              sum(as.numeric(USSenCP), na.rm = TRUE) +
              sum(as.numeric(USSenWI), na.rm = TRUE)
            )
colnames(county.2002)[1] <- 'HouseDistID'
summary(county.2002)

```

## 2004
```{r}

colnames(X2004_results)[which(colnames(X2004_results) == '7AM')] = 'reg'

county.2004 <- X2004_results %>%
  mutate(CPCTCode=getCPCTCode(CC, PRCT)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TotVoters),
            PresIR = sum(USPresR),
            PresDFL = sum(USPresDFL),
            PresOther = sum(USPresGP) + sum(USPresSE) + sum(USPresSW) + sum(USPresCF) + sum(USPresBL) + sum(USPresC) + sum(USPresL) + sum(USPresWI),
            CongIR = sum(USCongR),
            CongDFL = sum(USCongDFL),
            CongOther = sum(USCongI) + sum(USCongWI) + sum(USCongGr)
            )
colnames(county.2004)[1] <- 'HouseDistID'

summary(county.2004)
```

## 2006

```{r}
colnames(X2006_results)[which(colnames(X2006_results) == 'Registered\nat 7AM')] = 'reg'
X2006_results <- X2006_results[-which(X2006_results[,1] == 'Precinct\nName' ),]

county.2006 <- X2006_results %>%
  mutate(CPCTCode=getCPCTCode(County_ID, PRCT)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(as.numeric(reg), na.rm = TRUE),
            turnout = sum(as.numeric(TotVoters), na.rm = TRUE),
            CongIR = sum(as.numeric(CongR), na.rm = TRUE),
            CongDFL = sum(as.numeric(CongDFL), na.rm = TRUE),
            CongAll = sum(as.numeric(CongTOT), na.rm = TRUE),
            USSenIR = sum(as.numeric(USSenR), na.rm = TRUE),
            USSenDFL = sum(as.numeric(USSenDFL), na.rm = TRUE),
            USSenAll = sum(as.numeric(USSenTOT), na.rm = TRUE),
            GovIR = sum(as.numeric(GovR), na.rm = TRUE),
            GovDFL = sum(as.numeric(GovDFL), na.rm = TRUE),
            GovAll = sum(as.numeric(GovTOT), na.rm = TRUE)
            )
colnames(county.2006)[1] <- 'HouseDistID'

summary(county.2006)

```


## 2008

```{r}
colnames(X2008_results)[which(colnames(X2008_results) == '7AM')] = 'reg'

county.2008 <- X2008_results %>%
  mutate(CPCTCode=getCPCTCode(CountyID, PRCT)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TotVoters),
            PresIR = sum(USPRESR),
            PresDFL = sum(USPRESDFL),
            PresALL = sum(USPRESTOT),
            USSenIR = sum(USSENR),
            USSenDFL = sum(USSENDFL),
            USSenAll = sum(USSENTOT),
            CongIR = sum(CONGR),
            CongDFL = sum(CONGDFL),
            CongALL = sum(CONGTOT)
            )
colnames(county.2008)[1] <- 'HouseDistID'

summary(county.2008)

```

## 2010

```{r}

colnames(X2010_results)[which(colnames(X2010_results) == '7AM')] = 'reg'

county.2010 <- X2010_results %>%
  mutate(CPCTCode=getCPCTCode(CountyID, `Precinct Code`)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TotVoters),
            CongIR = sum(CONGR),
            CongDFL = sum(CONGDFL),
            CongAll = sum(CONGTOT),            
            GovIR = sum(GOVR),
            GovDFL = sum(GOVDFL),
            GovAll = sum(GOVTOT)   
            )
colnames(county.2010)[1] <- 'HouseDistID'

summary(county.2010)

```

## 2012

```{r}
colnames(X2012_results)[which(colnames(X2012_results) == '7AM')] = 'reg'

county.2012 <- X2012_results %>%
  mutate(CPCTCode=getCPCTCode(COUNTYCODE, PCTCODE)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TOTVOTING),
            PresIR = sum(USPRSR),
            PresDFL = sum(USPRSDFL),
            PresALL = sum(USPRSTOTAL),
            USSenIR = sum(USSENR),
            USSenDFL = sum(USSENDFL),
            USSenAll = sum(USSENTOTAL),
            CongIR = sum(USREPR),
            CongDFL = sum(USREPDFL),
            CongALL = sum(USREPTOTAL)
            )
colnames(county.2012)[1] <- 'HouseDistID'

summary(county.2012)

```


# 2014
```{r}
colnames(X2014_results)[which(colnames(X2014_results) == 'REG7AM')] = 'reg'

county.2014 <- X2014_results %>%
  mutate(CPCTCode=getCPCTCode(COUNTYCODE, PCTCODE)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TOTVOTING),
            CongIR = sum(USREPR),
            CongDFL = sum(USREPDFL),
            CongALL = sum(USREPTOTAL),            
            USSenIR = sum(USSENR),
            USSenDFL = sum(USSENDFL),
            USSenAll = sum(USSENTOTAL),
            GovIR = sum(MNGOVR),
            GovDFL = sum(MNGOVDFL),
            GovALL = sum(MNGOVTOTAL)   
            )
colnames(county.2014)[1] <- 'HouseDistID'

summary(county.2014)

```


## 2016 

```{r}
colnames(X2016_results)[which(colnames(X2016_results) == 'REG7AM')] = 'reg'

county.2016 <- X2016_results %>%
  mutate(CPCTCode=getCPCTCode(COUNTYCODE, PCTCODE)) %>%
  left_join(pctDist, by='CPCTCode' ) %>%
  group_by(pctDist_CONGDIST) %>%  
  summarise(reg = sum(reg),
            turnout = sum(TOTVOTING),
            PresIR = sum(USPRSR),
            PresDFL = sum(USPRSDFL),
            PresALL = sum(USPRSTOTAL),
            CongIR = sum(USREPR),
            CongDFL = sum(USREPDFL),
            CongALL = sum(USREPTOTAL)
            )
colnames(county.2016)[1] <- 'HouseDistID'

summary(county.2016)

```


```{r}
reg <- county.1992 %>% 
  mutate(reg_1992 = reg) %>% 
  select(one_of('HouseDistID', 'reg_1992')) %>% 
  full_join(
    county.1994 %>% 
      mutate(reg_1994 = reg) %>% 
      select(one_of('HouseDistID', 'reg_1994')), 
    by='HouseDistID') %>% 
  full_join(
    county.1996 %>% 
      mutate(reg_1996 = reg) %>% 
      select(one_of('HouseDistID', 'reg_1996')), 
    by='HouseDistID') %>%
  full_join(
    county.1998 %>% 
      mutate(reg_1998 = reg) %>% 
      select(one_of('HouseDistID', 'reg_1998')), 
    by='HouseDistID') %>%
  full_join(
    county.2000 %>% 
      mutate(reg_2000 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2000')), 
    by='HouseDistID') %>%
  full_join(
    county.2002 %>% 
      mutate(reg_2002 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2002')), 
    by='HouseDistID') %>%
  full_join(
    county.2004 %>% 
      mutate(reg_2004 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2004')), 
    by='HouseDistID') %>%
    full_join(
    county.2006 %>% 
      mutate(reg_2006 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2006')), 
    by='HouseDistID') %>%
  full_join(
    county.2008 %>% 
      mutate(reg_2008 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2008')), 
    by='HouseDistID') %>%
  full_join(
    county.2010 %>% 
      mutate(reg_2010 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2010')), 
    by='HouseDistID') %>%
  full_join(
    county.2012 %>% 
      mutate(reg_2012 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2012')), 
    by='HouseDistID') %>%
  full_join(
    county.2014 %>% 
      mutate(reg_2014 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2014')), 
    by='HouseDistID') %>%
  full_join(
    county.2016 %>% 
      mutate(reg_2016 = reg) %>% 
      select(one_of('HouseDistID', 'reg_2016')), 
    by='HouseDistID')
  
```


```{r}
turnout <- county.1992 %>% 
  mutate(turnout_1992 = turnout) %>% 
  select(one_of('HouseDistID', 'turnout_1992')) %>% 
  full_join(
    county.1994 %>% 
      mutate(turnout_1994 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_1994')), 
    by='HouseDistID') %>% 
  full_join(
    county.1996 %>% 
      mutate(turnout_1996 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_1996')), 
    by='HouseDistID') %>%
  full_join(
    county.1998 %>% 
      mutate(turnout_1998 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_1998')), 
    by='HouseDistID') %>%
  full_join(
    county.2000 %>% 
      mutate(turnout_2000 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2000')), 
    by='HouseDistID') %>%
  full_join(
    county.2002 %>% 
      mutate(turnout_2002 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2002')), 
    by='HouseDistID') %>%
  full_join(
    county.2004 %>% 
      mutate(turnout_2004 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2004')), 
    by='HouseDistID') %>%
  full_join(
    county.2006 %>% 
      mutate(turnout_2006 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2006')), 
    by='HouseDistID') %>%
  full_join(
    county.2008 %>% 
      mutate(turnout_2008 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2008')), 
    by='HouseDistID') %>%
  full_join(
    county.2010 %>% 
      mutate(turnout_2010 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2010')), 
    by='HouseDistID') %>%
  full_join(
    county.2012 %>% 
      mutate(turnout_2012 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2012')), 
    by='HouseDistID') %>%
  full_join(
    county.2014 %>% 
      mutate(turnout_2014 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2014')), 
    by='HouseDistID') %>%
  full_join(
    county.2016 %>% 
      mutate(turnout_2016 = turnout) %>% 
      select(one_of('HouseDistID', 'turnout_2016')), 
    by='HouseDistID') %>%
  arrange(HouseDistID)


```

```{r}

turnout$HouseDistID[is.na(turnout$HouseDistID)] = 0

temp <- turnout[which(turnout$HouseDistID != 0),][,-1]
turnoutTotal <- colSums(temp, na.rm = TRUE)
plot(turnoutTotal, type='l')


```